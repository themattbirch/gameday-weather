(()=>{"use strict";({905:function(){var e=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,a){function i(e){try{r(o.next(e))}catch(e){a(e)}}function l(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}r((o=o.apply(e,t||[])).next())}))};let t=null;const n={defaults:{darkMode:!1,temperatureUnit:"F",refreshInterval:3e5,retryAttempts:3,cacheExpiry:36e5},init(){return e(this,void 0,void 0,(function*(){return console.log("üîß Initializing SettingsManager"),yield this.migrateOldSettings(),yield this.validateSettings(),yield this.getAll()}))},migrateOldSettings(){return e(this,void 0,void 0,(function*(){try{const e=(yield chrome.storage.local.get(["settings"])).settings||{};Object.keys(e).length>0&&(yield this.saveAll(Object.assign(Object.assign({},this.defaults),e)),console.log("‚úÖ Settings migrated successfully"))}catch(e){console.error("‚ùå Settings migration failed:",e)}}))},validateSettings(){return e(this,void 0,void 0,(function*(){const e=yield this.getAll();let t=!1;Object.entries(this.defaults).forEach((([n,o])=>{void 0===e[n]&&(e[n]=o,t=!0)})),t&&(yield this.saveAll(e))}))},getAll(){return e(this,void 0,void 0,(function*(){try{return(yield chrome.storage.local.get(["settings"])).settings||Object.assign({},this.defaults)}catch(e){return console.error("‚ùå Error reading settings:",e),Object.assign({},this.defaults)}}))},saveAll(t){return e(this,void 0,void 0,(function*(){try{yield chrome.storage.local.set({settings:t}),console.log("üíæ Settings saved:",t)}catch(e){console.error("‚ùå Error saving settings:",e)}}))}};function o(e,t){const n=document.getElementById(`${e}-dropdown`);if(!n)return;const o=n.querySelector(".dropdown-list");if(!o)return;o.innerHTML="";const i=document.createElement("li");i.className="dropdown-search",i.innerHTML='<input type="text" placeholder="Search teams..." />',o.appendChild(i);const l=i.querySelector("input"),r=new Set;t.forEach((e=>{e.team&&e.team.split(/,|\//).forEach((e=>r.add(e.trim())))}));const c=document.createElement("li");c.textContent="nfl"===e?"NFL Teams":"College Teams",c.dataset.value="all",o.appendChild(c);const d=[];Array.from(r).sort().forEach((e=>{const t=document.createElement("li");t.textContent=e,t.dataset.value=e,o.appendChild(t),d.push(t)})),n.addEventListener("click",(function(t){console.log("Dropdown clicked",{type:e,isActive:this.classList.contains("active")}),t.stopPropagation(),a(this),this.classList.toggle("active"),this.classList.contains("active")&&l.focus();const n=this.querySelector(".dropdown-list");n&&(n.scrollTop=0)})),o.addEventListener("click",(function(t){if(t.stopPropagation(),"li"===t.target.tagName.toLowerCase()&&!t.target.classList.contains("dropdown-search")){const o=t.target.dataset.value,a=t.target.textContent;n.querySelector(".dropdown-selected").textContent=a,n.classList.remove("active"),s(e,o)}})),n.addEventListener("keydown",(function(e){const t=n.classList.contains("active"),o=this.querySelector(".dropdown-list");if(o)if("Enter"===e.key)if(e.preventDefault(),t){const e=Array.from(o.querySelectorAll('li:not(.dropdown-search):not([style*="display: none"])'));e.length>0&&e[0].click()}else n.click();else if("ArrowDown"===e.key){e.preventDefault();const t=30,n=o.scrollHeight-o.clientHeight;o.scrollTop=Math.min(o.scrollTop+t,n)}else if("ArrowUp"===e.key){e.preventDefault();const t=30;o.scrollTop=Math.max(o.scrollTop-t,0)}else"Escape"===e.key&&t&&n.classList.remove("active")})),l.addEventListener("input",(function(){const e=l.value.toLowerCase();d.forEach((t=>{t.textContent.toLowerCase().includes(e)?t.style.display="":t.style.display="none"}))}))}function s(n,o){console.log(`Selected ${n} team:`,o);const s="nfl"===n?"college":"nfl",a=document.getElementById(`${s}-dropdown`);if(a&&(a.querySelector(".dropdown-selected").textContent="nfl"===s?"NFL Teams":"College Teams"),"all"===o){const e=document.getElementById("weatherList");return void(e&&(e.innerHTML="",e.style.display="none"))}let d=t.stadiums.find((e=>e.team===o&&e.league===("nfl"===n?"NFL":"NCAA")));if(d||(d=t.stadiums.find((e=>e.team.toLowerCase().includes(o.toLowerCase())&&e.league===("nfl"===n?"NFL":"NCAA")))),d)!function(t){if(!t)return console.error("‚ùå No stadium provided to fetchWeather"),l("Stadium not found"),void i();let n=0;function o(){if(function(){const e=document.getElementById("loadingIndicator");e&&(e.style.display="block")}(),r(),function(){const e=document.getElementById("errorMessage");e&&(e.style.display="none",e.textContent="")}(),!navigator.onLine){console.log("üì° Network status: offline"),r();const e=document.getElementById("weatherList");return e&&(e.innerHTML='\n          <div class="offline-message">\n            <h3>You are offline</h3>\n            <p>Please check your internet connection and try again.</p>\n          </div>\n        ',e.style.display="flex"),void i()}chrome.runtime.sendMessage({type:"GET_WEATHER",latitude:t.latitude,longitude:t.longitude},(n=>e(this,void 0,void 0,(function*(){if(chrome.runtime.lastError)return console.error("Message error:",chrome.runtime.lastError),void s("Communication error with background script");if(n.error)return console.error("Weather fetch error:",n.error),void s("Weather data fetch failed");try{localStorage.setItem("weatherData",JSON.stringify(n)),localStorage.setItem("weatherDataTimestamp",Date.now().toString()),console.log("üíæ Weather data cached successfully")}catch(e){console.log("üìù Cache status: Failed to store weather data:",e)}i(),yield c(n,t)}))))}function s(e){if(n<3)n++,console.log(`üîÑ Retry attempt ${n} of 3`),setTimeout(o,1e3*n);else{i(),l(`${e} (after 3 retries)`);const n=localStorage.getItem("weatherData");if(n)try{c(JSON.parse(n),t),l("Showing cached data due to fetch failure")}catch(e){console.error("Fallback cache error:",e)}}}o()}(d);else{const e=document.getElementById("weatherList");e&&(e.innerHTML='<div class="error-message">Stadium not found</div>',e.style.display="flex")}}function a(e){document.querySelectorAll(".custom-dropdown.active").forEach((t=>{t!==e&&t.classList.remove("active")}))}function i(){const e=document.getElementById("loadingIndicator");e&&(e.style.display="none")}function l(e){const t=document.getElementById("errorMessage");t&&(t.style.display="block",t.textContent=e)}function r(){const e=document.getElementById("weatherList");e&&(e.innerHTML="",e.style.display="none")}function c(t,o){return e(this,void 0,void 0,(function*(){if(!t||!t.weather||!t.main)return void l("Incomplete weather data.");const s=document.getElementById("weatherList");if(!s)return;s.innerHTML="";const a=yield function(t,o){return e(this,void 0,void 0,(function*(){const e=document.createElement("div");e.className="game-card";const s=t.wind?Math.round(t.wind.speed):"N/A",a=t.main?t.main.humidity:"N/A";let i=t.main?t.main.feels_like:"N/A",l=t.main?t.main.temp:"N/A";const r=t.weather&&t.weather[0]?t.weather[0].icon:"",c=t.weather&&t.weather[0]?t.weather[0].description:"",d=yield n.getAll();console.log("üå°Ô∏è Temperature settings:",d);let u="¬∞F";var m;return"C"===d.temperatureUnit&&"N/A"!==l&&"N/A"!==i?(l=parseFloat(l),i=parseFloat(i),l=(5*(l-32)/9).toFixed(1),i=(5*(i-32)/9).toFixed(1),u="¬∞C"):"N/A"!==l&&"N/A"!==i&&(l=parseFloat(l).toFixed(1),i=parseFloat(i).toFixed(1)),e.innerHTML=`\n    <div class="weather-icon-container">\n      ${r?`<img class="weather-icon" src="https://openweathermap.org/img/w/${r}.png" alt="${c}">`:""}\n      <div class="temperature">${"N/A"!==l?l+u:"N/A"}</div>\n    </div>\n    <div class="game-info">\n      <h3>${o.name||"Unknown Stadium"}</h3>\n      <div class="team-name">${o.team||"Unknown Team"}</div>\n      <div class="conditions">${m=c,(m?m.charAt(0).toUpperCase()+m.slice(1):"")||"N/A"}</div>\n      <div class="weather-details">\n        <div class="detail">\n          <span class="label">Feels like:</span> \n          <span class="value">${"N/A"!==i?i+u:"N/A"}</span>\n        </div>\n        <div class="detail">\n          <span class="label">Wind:</span> \n          <span class="value">${"N/A"!==s?s+" mph":"N/A"}</span>\n        </div>\n        <div class="detail">\n          <span class="label">Humidity:</span> \n          <span class="value">${"N/A"!==a?a+"%":"N/A"}</span>\n        </div>\n      </div>\n    </div>\n  `,e}))}(t,o);s.appendChild(a),s.style.display="flex"}))}function d(){console.log("‚öôÔ∏è Opening settings");const e=function(){const e=document.createElement("div");e.className="settings-modal";const t=document.createElement("div");t.className="settings-content";const o=n.getAll();return console.log("üìä Current settings for modal:",o),t.innerHTML=`\n    <h2>Settings</h2>\n    <div class="settings-section">\n        <div class="setting-item">\n            <label for="darkMode">Dark Mode</label>\n            <input type="checkbox" id="darkMode" ${o.darkMode?"checked":""} />\n        </div>\n        <div class="setting-item">\n            <label for="temperatureUnit">Temperature Unit</label>\n            <select id="temperatureUnit">\n                <option value="F" ${"F"===o.temperatureUnit?"selected":""}>Fahrenheit (¬∞F)</option>\n                <option value="C" ${"C"===o.temperatureUnit?"selected":""}>Celsius (¬∞C)</option>\n            </select>\n        </div>\n    </div>\n    <div class="settings-footer">\n        <div class="privacy-policy-container">\n            <a href="https://gameday-weather.vercel.app/privacy" target="_blank" class="privacy-link">\n                Privacy Policy\n            </a>\n        </div>\n        <div class="button-container">\n            <button class="cancel-btn">Cancel</button>\n            <button class="save-btn">Save</button>\n        </div>\n    </div>\n  `,e.appendChild(t),e}(),t=document.createElement("div");t.className="modal-overlay",document.body.appendChild(t),document.body.appendChild(e);const o=e.querySelector(".save-btn"),s=e.querySelector(".cancel-btn"),a=()=>{document.body.removeChild(e),document.body.removeChild(t)};o.addEventListener("click",(()=>{console.log("üíæ Saving settings");const t=n.getAll();t.darkMode=e.querySelector("#darkMode").checked,t.temperatureUnit=e.querySelector("#temperatureUnit").value,n.saveAll(t),console.log("‚úÖ Updated settings:",t),t.darkMode?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),a(),u()})),s.addEventListener("click",a),t.addEventListener("click",(e=>{e.target===t&&a()}))}function u(){const e=document.getElementById("nfl-dropdown"),t=document.getElementById("college-dropdown");let n=null,o=null;const a=e.querySelector(".dropdown-selected").textContent,i=t.querySelector(".dropdown-selected").textContent;if(a&&"NFL Teams"!==a?(n=a,o="nfl"):i&&"College Teams"!==i&&(n=i,o="college"),console.log("üîÑ Refreshing weather for:",{selectedTeam:n,dropdownType:o}),n)s(o,n);else{console.log("‚ö†Ô∏è No team selected for refresh");const e=document.getElementById("weatherList"),t=document.getElementById("errorMessage");e&&(e.innerHTML="",e.style.display="none"),t&&(t.style.display="none")}}function m(e){const t=e.target.value;console.log("üìÖ Date selected:",t)}document.addEventListener("DOMContentLoaded",(function(){return e(this,void 0,void 0,(function*(){try{const s=n.init();console.log("üöÄ App initializing with settings:",s);const a=chrome.runtime.getURL("/data/stadium_coordinates.json"),i=yield fetch(a);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const l=yield i.json();t=function(e){if(!e||"object"!=typeof e)return console.error("Invalid stadium data received:",e),{stadiums:[]};const t=[];try{return e.nfl&&"object"==typeof e.nfl&&Object.entries(e.nfl).forEach((([e,n])=>{n&&"object"==typeof n&&t.push({name:e,team:n.team,league:"NFL",latitude:n.latitude,longitude:n.longitude,location:n.location})})),e.ncaa&&"object"==typeof e.ncaa&&Object.entries(e.ncaa).forEach((([e,n])=>{n&&"object"==typeof n&&t.push({name:e,team:n.team,league:"NCAA",latitude:n.latitude,longitude:n.longitude,location:n.location})})),{stadiums:t}}catch(e){return console.error("Error during transformation:",e),{stadiums:[]}}}(l),o("nfl",(e=t).stadiums.filter((e=>"NFL"===e.league))),o("college",e.stadiums.filter((e=>"NCAA"===e.league)));const r={"weather-date":{handler:m,event:"change"},refresh:{handler:u,event:"click"},settings:{handler:d,event:"click"}};Object.entries(r).forEach((([e,t])=>{const n=document.getElementById(e);n?(console.log(`‚úÖ Adding ${t.event} listener to ${e}`),n.addEventListener(t.event,t.handler)):console.log(`‚ÑπÔ∏è Element with ID '${e}' not found`)})),n.getAll().darkMode?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode");const c=document.getElementById("weatherList");c&&(c.style.display="none")}catch(e){console.error("Initialization failed:",e),console.error("Error stack:",e.stack);const t=document.getElementById("weatherList");t&&(t.innerHTML=`<div class="error-message">Failed to load stadium data: ${e.message}</div>`,t.style.display="none")}var e}))})),document.addEventListener("click",(function(){a()})),document.addEventListener("DOMContentLoaded",(()=>{if(!navigator.onLine){const e=document.getElementById("offlineMessage");e&&(e.style.display="block")}window.addEventListener("online",(()=>{const e=document.getElementById("offlineMessage");e&&(e.style.display="none")})),window.addEventListener("offline",(()=>{const e=document.getElementById("offlineMessage");e&&(e.style.display="block")}))}))}})[905]()})();